<div class="space-y-4">
    <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100">History</h3>

    {% if history_records %}
    <div class="flow-root">
        <ul role="list" class="-mb-8">
            {% for record in history_records %}
            <li>
                <div class="relative pb-8">
                    {% if not forloop.last %}
                    <span class="absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200 dark:bg-gray-700"
                        aria-hidden="true"></span>
                    {% endif %}
                    <div class="relative flex space-x-3">
                        <div>
                            <span class="h-8 w-8 rounded-full flex items-center justify-center ring-8 ring-white dark:ring-gray-800
                                        {% if record.history_type == '+' %}bg-green-500
                                        {% elif record.history_type == '~' %}bg-blue-500
                                        {% else %}bg-red-500{% endif %}">
                                <i class="fas 
                                            {% if record.history_type == '+' %}fa-plus
                                            {% elif record.history_type == '~' %}fa-pencil
                                            {% else %}fa-trash{% endif %} text-white text-xs"></i>
                            </span>
                        </div>
                        <div class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">
                                    <span class="font-medium text-gray-900 dark:text-gray-100">
                                        {{ record.history_user|default:"System" }}
                                    </span>
                                    {% if record.history_type == '+' %}created
                                    {% elif record.history_type == '~' %}updated
                                    {% else %}deleted{% endif %}
                                    the {{ record.model_name|default:"item"|lower }}
                                </p>
                                {% if record.history_type == '~' and record.delta %}
                                    <div class="mt-2 text-xs text-gray-500 dark:text-gray-400 bg-gray-50 dark:bg-gray-900 p-2 rounded">
                                        <ul class="list-disc list-inside">
                                            {% for change in record.delta.changes %}
                                                <li>
                                                    <span class="font-medium">{{ change.field }}</span>: 
                                                    <span class="line-through text-red-400">{{ change.old }}</span> 
                                                    &rarr; 
                                                    <span class="text-green-600 dark:text-green-400">{{ change.new }}</span>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </div>
                                {% endif %}
                            </div>
                            <div class="whitespace-nowrap text-right text-sm text-gray-500 dark:text-gray-400">
                                <time datetime="{{ record.history_date|date:'c' }}">{{ record.history_date|date:"M d, Y H:i" }}</time>
                            </div>
                        </div>
                    </div>
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
    {% else %}
    <p class="text-gray-500 dark:text-gray-400">No history available.</p>
    {% endif %}
</div>