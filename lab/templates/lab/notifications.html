{% extends "lab/base.html" %}


{% partialdef notification-items inline %}
  {% for notification in notifications %}
    {% if notification.target %}
      {% with app_label=notification.target_content_type.app_label model_name=notification.target_content_type.model|capfirst pk=notification.target_object_id %}
        <div
          class="p-6 border-l-4 transition-colors
          {% if model_name == 'Individual' %}
            border-blue-500 dark:border-blue-400 bg-blue-50 dark:bg-blue-900/10
          {% elif model_name == 'Sample' %}
            border-green-500 dark:border-green-400 bg-green-50 dark:bg-green-900/10
          {% elif model_name == 'Test' %}
            border-orange-500 dark:border-orange-400 bg-orange-50 dark:bg-orange-900/10
          {% elif model_name == 'Pipeline' %}
            border-red-500 dark:border-red-400 bg-red-50 dark:bg-red-900/10
          {% elif model_name == 'Project' %}
            border-purple-500 dark:border-purple-400 bg-purple-50 dark:bg-purple-900/10
          {% elif model_name == 'Task' %}
            border-yellow-500 dark:border-yellow-400 bg-yellow-50 dark:bg-yellow-900/10
          {% else %}
            border-indigo-300 dark:border-indigo-600 bg-indigo-50 dark:bg-indigo-900/10
          {% endif %}"
        >
          <div class="flex items-start space-x-4">
            <!-- Notification Icon -->
            <div class="flex-shrink-0">
              {% if notification.unread %}
                <div class="w-3 h-3 bg-red-500 rounded-full"></div>
              {% else %}
                <div class="w-3 h-3 bg-gray-400 rounded-full"></div>
              {% endif %}
            </div>
            
            <!-- Notification Content -->
            <div class="flex-1 min-w-0">
              <div class="flex items-center justify-between">
                <p class="text-sm font-medium text-gray-900 dark:text-gray-100">
                  {{ notification.verb }}
                </p>
                <span class="text-xs text-gray-500 dark:text-gray-400">
                  {{ notification.timestamp|timesince }} ago
                </span>
              </div>
              
              {% if notification.description %}
                <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
                  {{ notification.description|linebreaksbr }}
                </p>
              {% endif %}
              
              <div class="mt-2">
                <a
                  href="{% url 'lab:generic_detail' %}?app_label={{ app_label }}&model_name={{ model_name }}&pk={{ pk }}"
                  hx-get="{% url 'lab:generic_detail' %}?app_label={{ app_label }}&model_name={{ model_name }}&pk={{ pk }}"
                  hx-target="#detail-view"
                  hx-swap="innerHTML"
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800 dark:bg-indigo-900 dark:text-indigo-200 hover:bg-indigo-200 dark:hover:bg-indigo-800 transition-colors"
                  @click.prevent="openDetail({{ pk }}, '{{ model_name }}', '{{ app_label }}')"
                >
                  <i class="fas fa-link mr-1"></i>
                  Related Item
                </a>
              </div>
            </div>
          </div>
        </div>
      {% endwith %}
    {% else %}
      <div class="p-6 border-l-4 border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 transition-colors">
        <div class="flex items-start space-x-4">
          <!-- Notification Icon -->
          <div class="flex-shrink-0">
            {% if notification.unread %}
              <div class="w-3 h-3 bg-red-500 rounded-full"></div>
            {% else %}
              <div class="w-3 h-3 bg-gray-400 rounded-full"></div>
            {% endif %}
          </div>
          
          <!-- Notification Content -->
          <div class="flex-1 min-w-0">
            <div class="flex items-center justify-between">
              <p class="text-sm font-medium text-gray-900 dark:text-gray-100">
                {{ notification.verb }}
              </p>
              <span class="text-xs text-gray-500 dark:text-gray-400">
                {{ notification.timestamp|timesince }} ago
              </span>
            </div>
            
            {% if notification.description %}
              <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">
                {{ notification.description|linebreaksbr }}
              </p>
            {% endif %}
          </div>
        </div>
      </div>
    {% endif %}
  {% endfor %}
{% endpartialdef %}

{% partialdef notifications-load-more %}
  <div id="notifications-load-more">
    {% if page_obj and page_obj.has_next %}
      <button
        hx-get="{% url 'lab:notifications' %}?page={{ page_obj.next_page_number }}&append=1{% if scope %}&scope={{ scope }}{% endif %}"
        hx-target="#notifications-list"
        hx-swap="beforeend"
        hx-indicator="#notifications-loading-indicator"
        class="w-full inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-b-lg hover:bg-indigo-100 dark:text-indigo-300 dark:bg-indigo-900/30 dark:border-indigo-700 dark:hover:bg-indigo-900/50 transition-colors"
      >
        <i class="fas fa-rotate-right mr-2 animate-spin" aria-hidden="true"></i>
        Load more
      </button>
    {% else %}
      <div class="px-6 py-3 text-center text-sm text-gray-500 dark:text-gray-400">
        No more notifications
      </div>
    {% endif %}
  </div>
{% endpartialdef %}

{% partialdef notifications-load-more-oob %}
  <div id="notifications-load-more" hx-swap-oob="true">
    {% if page_obj and page_obj.has_next %}
      <button
        hx-get="{% url 'lab:notifications' %}?page={{ page_obj.next_page_number }}&append=1{% if scope %}&scope={{ scope }}{% endif %}"
        hx-target="#notifications-list"
        hx-swap="beforeend"
        hx-indicator="#notifications-loading-indicator"
        class="w-full inline-flex items-center justify-center px-4 py-2 text-sm font-medium text-indigo-600 bg-indigo-50 border border-indigo-200 rounded-b-lg hover:bg-indigo-100 dark:text-indigo-300 dark:bg-indigo-900/30 dark:border-indigo-700 dark:hover:bg-indigo-900/50 transition-colors"
      >
        <i class="fas fa-rotate-right mr-2 animate-spin" aria-hidden="true"></i>
        Load more
      </button>
    {% else %}
      <div class="px-6 py-3 text-center text-sm text-gray-500 dark:text-gray-400">
        No more notifications
      </div>
    {% endif %}
  </div>
{% endpartialdef %}

{% partialdef notifications-append %}
  {% partial notification-items %}
  {% partial notifications-load-more-oob %}
{% endpartialdef %}

{% partialdef notifications-content inline %}
<!-- Notifications Content -->
<div class="max-w-4xl mx-auto">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center justify-between mb-4">
      <h1 class="text-3xl font-bold text-gray-900 dark:text-gray-100">
        <i class="fas fa-bell text-indigo-500 mr-3"></i>
        Notifications
      </h1>
    </div>
    <p class="text-gray-600 dark:text-gray-400">
      Stay updated with the latest changes and activities in your projects.
    </p>
    <div class="mt-4 inline-flex rounded-xl bg-gray-100 dark:bg-gray-800 p-1">
      {% with current_scope=scope|default:"all"|lower %}
        <button
          hx-get="{% url 'lab:notifications' %}?scope=all"
          hx-target="#notifications-content"
          hx-swap="innerHTML"
          class="px-4 py-2 text-sm font-medium rounded-lg transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 {% if current_scope == 'all' %}bg-white dark:bg-gray-700 text-indigo-700 dark:text-indigo-200 shadow{% else %}text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white{% endif %}"
          aria-pressed="{% if current_scope == 'all' %}true{% else %}false{% endif %}"
        >
          All
        </button>
        <button
          hx-get="{% url 'lab:notifications' %}?scope=associated"
          hx-target="#notifications-content"
          hx-swap="innerHTML"
          class="px-4 py-2 text-sm font-medium rounded-lg transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500 {% if current_scope == 'associated' %}bg-white dark:bg-gray-700 text-indigo-700 dark:text-indigo-200 shadow{% else %}text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white{% endif %}"
          aria-pressed="{% if current_scope == 'associated' %}true{% else %}false{% endif %}"
        >
          Associated
        </button>
      {% endwith %}
    </div>
  </div>

  <!-- Notifications List -->
  <div class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700">
    {% if notifications %}
      <div id="notifications-list" class="divide-y divide-gray-200 dark:divide-gray-700">
        {% partial notification-items %}
      </div>
      <div id="notifications-loading-indicator" class="hidden text-center py-3">
        <i class="fas fa-spinner fa-spin text-indigo-500"></i>
      </div>
      {% partial notifications-load-more %}
    {% else %}
      <!-- Empty State -->
      <div class="p-12 text-center">
        <div class="mx-auto w-16 h-16 bg-gray-100 dark:bg-gray-700 rounded-full flex items-center justify-center mb-4">
          <i class="fas fa-bell text-gray-400 text-2xl"></i>
        </div>
        <h3 class="text-lg font-medium text-gray-900 dark:text-gray-100 mb-2">
          No notifications yet
        </h3>
        <p class="text-gray-600 dark:text-gray-400">
          You'll see notifications here when there are updates to your projects, tasks, or other items you're involved with.
        </p>
      </div>
    {% endif %}
  </div>
</div>
{% endpartialdef %}

{% block content %}
<!-- This template is now used for both full page and partial rendering -->
{% partial notifications-content %}
{% endblock %} 