

{% partialdef drawer %}
  <!-- Alpine.js Right-side Drawer -->
  <div x-show="open" x-cloak>
    <!-- Overlay -->
    <div x-show="open" @click= "open=false" class="fixed inset-0 bg-black bg-opacity-30 z-40 transition-opacity duration-200" x-transition.opacity></div>

    <!-- Drawer -->
    <aside
      x-show="open"
      x-transition:enter="transition transform duration-300"
      x-transition:enter-start="translate-x-full"
      x-transition:enter-end="translate-x-0"
      x-transition:leave="transition transform duration-200"
      x-transition:leave-start="translate-x-0"
      x-transition:leave-end="translate-x-full"
      class="fixed top-0 right-0 h-full w-80 bg-white dark:bg-gray-800 shadow-lg z-50 flex flex-col"
      role="dialog"
      aria-modal="true"
      aria-labelledby="filter-drawer-label"
    >
      <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">
        <h5 id="filter-drawer-label" class="text-base font-semibold text-gray-700 dark:text-gray-200">Filters</h5>
        <button @click= "open=false" type="button" class="text-gray-400 hover:text-gray-700 dark:hover:text-white focus:outline-none">
          <i class="fa-solid fa-circle-xmark"></i>
        </button>
      </div>
      <div class="p-4 flex-1 overflow-y-auto space-y-6">
        <!-- Individuals -->
        <div>
          <h6 class="font-semibold text-gray-700 dark:text-gray-200 mb-2">
          {% with app_label='lab' model_name='Individual' icon_class='fa-person' %}
            {% include "lab/partials/partials.html#generic-search" %}
          {% endwith %}
          {% with app_label='lab' model_name='Individual' icon_class='fa-person' %}
            {% include "lab/partials/partials.html#generic-type-filter" %}
          {% endwith %}
          {% with app_label='lab' model_name='Individual' %}
            {% include "lab/partials/partials.html#generic-status-filter" %}
          {% endwith %}
          
          <div class="mt-4 space-y-2">
            <h6 class="text-sm font-semibold text-gray-700 dark:text-gray-200 mb-1">Files</h6>
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="checkbox" 
                     name="filter_has_request_form" 
                     value="true" 
                     x-model="filters.has_request_form"
                     @change="dispatchFiltersUpdated('individual')"
                     class="form-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 transition duration-150 ease-in-out">
              <span class="text-sm text-gray-700 dark:text-gray-300">Has Request Form</span>
            </label>
            <label class="flex items-center space-x-2 cursor-pointer">
              <input type="checkbox" 
                     name="filter_has_analysis_report" 
                     value="true" 
                     x-model="filters.has_analysis_report"
                     @change="dispatchFiltersUpdated('individual')"
                     class="form-checkbox h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 transition duration-150 ease-in-out">
              <span class="text-sm text-gray-700 dark:text-gray-300">Has Analysis Report</span>
            </label>
          </div>
        </h6>
        </div>
        <!-- Samples -->
        <div>
          <h6 class="font-semibold text-gray-700 dark:text-gray-200 mb-2">
          </h6>
          {% with app_label='lab' model_name='Sample' icon_class='fa-vial' %}
            {% include "lab/partials/partials.html#generic-search" %}
          {% endwith %}
          {% with app_label='lab' model_name='Sample' icon_class='fa-vial' %}
            {% include "lab/partials/partials.html#generic-type-filter" %}
          {% endwith %}
          {% with app_label='lab' model_name='Sample' %}
            {% include "lab/partials/partials.html#generic-status-filter" %}
          {% endwith %}
        </div>
        <!-- Tests -->
        <div>
          <h6 class="font-semibold text-gray-700 dark:text-gray-200 mb-2">
          </h6>
          {% with app_label='lab' model_name='Test' icon_class='fa-flask-vial' name='test' value_field='id' initial=initial_tests is_filter='True' %}
            {% include "lab/partials/partials.html#generic-combobox" %}
            <div class="hidden" hx-get="{% url 'lab:generic_search' %}" hx-trigger="load-test from:window, filters-updated from:window, filters-updated-test from:window" hx-target="#page-test-results" :hx-vals="getHxVals('lab', 'Test', 1, viewMode)"></div>
          {% endwith %}
          {% with app_label='lab' model_name='Test' icon_class='fa-flask-vial' %}
            {% include "lab/partials/partials.html#generic-type-filter" %}
          {% endwith %}
          {% with app_label='lab' model_name='Test' %}
            {% include "lab/partials/partials.html#generic-status-filter" %}
          {% endwith %}
        </div>
        <!-- Analyses -->
        <div>
          <h6 class="font-semibold text-gray-700 dark:text-gray-200 mb-2">
          </h6>
          {% with app_label='lab' model_name='Analysis' icon_class='fa-laptop' name='analysis' value_field='id' initial=initial_analyses is_filter='True' %}
            {% include "lab/partials/partials.html#generic-combobox" %}
            <div class="hidden" hx-get="{% url 'lab:generic_search' %}" hx-trigger="load-analysis from:window, filters-updated from:window, filters-updated-analysis from:window, filters-updated-individual from:window" hx-target="#page-analysis-results" :hx-vals="getHxVals('lab', 'Analysis', 1, viewMode)"></div>
          {% endwith %}
          {% with app_label='lab' model_name='Analysis' icon_class='fa-laptop' %}
            {% include "lab/partials/partials.html#generic-type-filter" %}
          {% endwith %}
          {% with app_label='lab' model_name='Analysis' %}
            {% include "lab/partials/partials.html#generic-status-filter" %}
          {% endwith %}

          
        </div>
        <!-- Variants -->
        <div>
          <h6 class="font-semibold text-gray-700 dark:text-gray-200 mb-2">
          </h6>
          {% with app_label='variant' model_name='Variant' icon_class='fa-dna' target_id='#drawer-results-sink' %}
            {% include "lab/partials/partials.html#generic-search" %}
          {% endwith %}
          {% with app_label='variant' model_name='Variant' icon_class='fa-dna' %}
            {% include "lab/partials/partials.html#generic-type-filter" %}
          {% endwith %}
          {% with app_label='variant' model_name='Variant' %}
            {% include "lab/partials/partials.html#generic-status-filter" %}
          {% endwith %}
          {% with app_label='variant' model_name='Gene' icon_class='fa-dna' name='Gene' value_field='id' is_filter='True' %}
            {% include "lab/partials/partials.html#generic-combobox" %}
          {% endwith %}
        </div>
        <!-- Institutions -->
        <div>
          <h6 class="font-semibold text-gray-700 dark:text-gray-200 mb-2">
          </h6>
          {% with app_label='lab' model_name='Institution' icon_class='fa-building-columns' name='institution' value_field='id' initial=initial_institutions is_filter='True' %}
            {% include "lab/partials/partials.html#generic-combobox" %}
            <div class="hidden" hx-get="{% url 'lab:generic_search' %}" hx-trigger="load-institution from:window, filters-updated from:window, filters-updated-institution from:window" hx-target="#page-institution-results" :hx-vals="getHxVals('lab', 'Institution', 1, viewMode)"></div>
          {% endwith %}
        </div>
        <!-- Projects -->
        <div>
          <h6 class="font-semibold text-gray-700 dark:text-gray-200 mb-2">
          </h6>
          {% with app_label='lab' model_name='Project' icon_class='fa-diagram-project' name='project' value_field='id' initial=initial_projects is_filter='True' %}
            {% include "lab/partials/partials.html#generic-combobox" %}
            <div class="hidden" hx-get="{% url 'lab:generic_search' %}" hx-trigger="load-project from:window, filters-updated from:window, filters-updated-project from:window" hx-target="#page-project-results" :hx-vals="getHxVals('lab', 'Project', 1, viewMode)"></div>
          {% endwith %}
          {% with app_label='lab' model_name='Project' %}
            {% include "lab/partials/partials.html#generic-status-filter" %}
          {% endwith %}
        </div>
        <!-- Tasks -->
        <div>
          <h6 class="font-semibold text-gray-700 dark:text-gray-200 mb-2">
          </h6>
          {% with app_label='lab' model_name='Task' icon_class='fa-list-check' %}
            {% include "lab/partials/partials.html#generic-search" %}
          {% endwith %}
        </div>
        <!-- HPO Terms -->
        <div>
          <h6 class="font-semibold text-gray-700 dark:text-gray-200 mb-2">
          </h6>
          {% with app_label='ontologies' model_name='Term' icon_class='fa-stethoscope' %}
            {% include "lab/partials/partials.html#generic-search" %}
          {% endwith %}
        </div>
      </div>
      </div>
    </aside>
    <!-- Hidden sink for HTMX requests that rely on OOB swaps -->
    <div id="drawer-results-sink" class="hidden"></div>
  </div>
{% endpartialdef drawer %}
